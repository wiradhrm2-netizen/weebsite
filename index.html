<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AOS | Absensi Online Siswa</title>
<style>
/* Reset & Font */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Poppins', sans-serif; background: #f9faff; color: #1a2b5f; position: relative; overflow-x: hidden; padding-bottom: 50px; }
/* Loading Screen */
#loadingAOS { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); display: flex; justify-content: center; align-items: center; flex-direction: column; z-index: 9999; transition: opacity 0.5s ease; }
.loader-circle { width: 70px; height: 70px; border: 6px solid #c9d6ff; border-top: 6px solid #346dff; border-radius: 50%; animation: spin 1s linear infinite; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.loading-text { margin-top: 15px; font-size: 18px; font-weight: 600; color: #1a2b5f; letter-spacing: 1px; }
/* Logo */
.logo { width: 120px; height: auto; margin-bottom: 30px; display: block; }
/* Sections */
.section { min-height: 100vh; display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
.section.active { display: flex; }
.section h1, .section h2 { color: #346dff; margin-bottom: 15px; }
.section p { font-size: 1rem; color: #1a2b5f; margin-bottom: 20px; max-width: 800px; }
/* Button */
.btn-primary, .btn-back { display: inline-block; background: #346dff; color: #fff; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; font-weight: 600; text-decoration: none; transition: all 0.3s ease; }
.btn-primary:hover, .btn-back:hover { background: #1a52d1; }
/* Hamburger Menu */
.hamburger { position: fixed; top: 20px; right: 20px; width: 35px; height: 30px; display: flex; flex-direction: column; justify-content: space-between; cursor: pointer; z-index: 10001; }
.hamburger span { display: block; height: 4px; background: #346dff; border-radius: 2px; transition: all 0.3s ease; }
.hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(6px, 6px); }
.hamburger.active span:nth-child(2) { opacity: 0; }
.hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(7px, -7px); }
/* Sidebar Menu */
.sidebar { position: fixed; top: 0; right: -250px; width: 250px; height: 100%; background: #346dff; color: #fff; padding: 60px 20px; display: flex; flex-direction: column; gap: 20px; transition: right 0.3s ease; z-index: 10000; }
.sidebar a { color: #fff; text-decoration: none; font-size: 1.1rem; transition: color 0.2s ease; }
.sidebar a:hover { color: #c9d6ff; }
.sidebar.active { right: 0; }
/* Overlay */
.overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); opacity: 0; visibility: hidden; transition: opacity 0.3s ease; z-index: 9999; }
.overlay.active { opacity: 1; visibility: visible; }
/* Tabel Absensi */
.absensi-table { border:4px solid #FFD700; border-radius:10px; overflow:hidden; width:100%; max-width:700px; margin:30px auto; }
.absensi-table table { width:100%; border-collapse:collapse; }
.absensi-table th { background:#FFD700; color:#1a2b5f; padding:12px; }
.absensi-table td { padding:10px; }
.absensi-table tr:nth-child(even) td { background:#f0f0f0; }
.absensi-table tr:nth-child(odd) td { background:#fff; }
/* Responsive */
@media (max-width: 600px) { .section h1 { font-size: 2rem; } .section h2 { font-size: 1.5rem; } }
</style>
</head>
<body>

<!-- Hamburger Menu -->
<div class="hamburger" id="hamburgerMenu">
    <span></span><span></span><span></span>
</div>
<!-- Sidebar Menu -->
<div class="sidebar" id="sidebarMenu">
    <a href="#" data-section="tentang">Tentang AOS</a>
</div>
<!-- Overlay -->
<div class="overlay" id="overlay"></div>

<!-- Logo -->
<img class="logo" src="AOS_logo.png" alt="Logo AOS" />

<!-- Loading Screen -->
<div id="loadingAOS">
    <div class="loader-circle"></div>
    <div class="loading-text">AOS Loading...</div>
</div>

<!-- Section: Beranda -->
<div class="section active" id="home">
    <h1>AOS — Absensi Online Siswa</h1>
    <p>Silahkan pilih untuk masuk ke halaman absensi.</p>
    <button onclick="location.href='absensi.html'" class="btn-primary">Masuk ke Absensi</button>

    <!-- Tabel Absensi -->
    <div class="absensi-table">
        <table id="tabelAbsensi">
            <thead>
                <tr>
                    <th>Tanggal</th>
                    <th>NIS</th>
                    <th>Nama</th>
                    <th>Kelas</th>
                    <th>Status</th>
                    <th>Keterangan</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data absensi muncul di sini -->
            </tbody>
        </table>
    </div>
</div>

<!-- Section: Tentang AOS -->
<div class="section" id="tentang">
    <h2>Apa itu AOS?</h2>
    <p>AOS (Absensi Online Siswa) adalah sistem absensi berbasis web untuk memudahkan sekolah dalam mencatat kehadiran siswa secara digital. Proses absensi menjadi cepat, akurat, dan ramah lingkungan karena mengurangi penggunaan kertas.</p>
    <h2>Fitur Utama AOS</h2>
    <p> 1. Absensi QR Code<br> 2. Form Manual<br> 3. Laporan Real-Time<br> 4. Notifikasi Absensi </p>
    <h2>Manfaat AOS</h2>
    <p>Meningkatkan efisiensi pencatatan kehadiran, meminimalkan kesalahan data, mempermudah monitoring, dan siswa dapat melakukan absensi tanpa antre panjang.</p>
    <a href="#" class="btn-back" data-section="home">Kembali ke Beranda</a>
</div>

<!-- Tambahan Notifikasi WA -->
<div id="successMsg" style="display:none; color:green; margin:10px 0; font-weight:bold;">
    Absen berhasil, WA siap dikirim ke admin ✅
</div>
<div id="notif" style="display:block; color:red; margin:10px 0; font-weight:bold;"></div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
// ===== Script Asli Loading + Hamburger + Tabel =====
window.onload = () => {
    setTimeout(() => {
        const loading = document.getElementById('loadingAOS');
        loading.style.opacity = '0';
        loading.style.pointerEvents = 'none';
        setTimeout(() => loading.style.display = 'none', 500);
        loadAbsensi();
    }, 1200);
};

const hamburger = document.getElementById('hamburgerMenu');
const sidebar = document.getElementById('sidebarMenu');
const overlay = document.getElementById('overlay');
const sections = document.querySelectorAll('.section');
hamburger.addEventListener('click', () => {
    hamburger.classList.toggle('active');
    sidebar.classList.toggle('active');
    overlay.classList.toggle('active');
});
overlay.addEventListener('click', () => {
    hamburger.classList.remove('active');
    sidebar.classList.remove('active');
    overlay.classList.remove('active');
});
sidebar.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = link.getAttribute('data-section');
        sections.forEach(sec => sec.classList.remove('active'));
        const activeSection = document.getElementById(target);
        if(activeSection) activeSection.classList.add('active');
        hamburger.classList.remove('active');
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
    });
});
document.querySelectorAll('.btn-back').forEach(btn => {
    btn.addEventListener('click', (e) => {
        e.preventDefault();
        sections.forEach(sec => sec.classList.remove('active'));
        document.getElementById('home').classList.add('active');
    });
});
function loadAbsensi() {
    const data = JSON.parse(localStorage.getItem("absensiAOS") || "[]");
    const tbody = document.getElementById("tabelAbsensi").querySelector("tbody");
    tbody.innerHTML = "";
    data.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${item.tanggal}</td>
            <td>${item.nis}</td>
            <td>${item.nama}</td>
            <td>${item.kelas}</td>
            <td>${item.status}</td>
            <td>${item.ket || "-"}</td>
        `;
        tbody.appendChild(row);
    });
}

// ===== Tambahan WA Manual & QR Scan =====
let sudahAbsen = false;
const beep = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
function showSuccessWA() {
    const success = document.getElementById("successMsg");
    if(success) success.style.display = "block";
    beep.play();
}
function showNotif(msg) {
    const n = document.getElementById("notif");
    if(n){ n.innerText = msg; n.classList.add("show"); setTimeout(() => n.classList.remove("show"),2000);}
}
function kunciForm() {
    document.querySelectorAll("input, select, #kirimManual").forEach(el => el.disabled=true);
}
function kirimWAmanual(nama, no_absen, nis, status, keterangan, tanggal){
    const pesan = `ABSENSI SISWA
Nama: ${nama}
No Absen: ${no_absen}
NIS: ${nis}
Status: ${status}
Keterangan: ${keterangan}
Tanggal: ${tanggal}`;
    const nomorAdmin = "081233310308".replace(/^0/,"62");
    const url = `https://wa.me/${nomorAdmin}?text=${encodeURIComponent(pesan)}`;
    window.open(url,"_blank");
}

/* QR Scan */
const qrReader = new Html5Qrcode("reader");
Html5Qrcode.getCameras().then(cameras=>{
    if(cameras.length===0){ showNotif("⚠️ Kamera tidak ditemukan"); return;}
    let backCamera = cameras.find(c=>c.label.toLowerCase().includes("back"))||cameras[0];
    qrReader.start(backCamera.id,{fps:10,qrbox:250}, qr=>{
        if(sudahAbsen) return;
        if(!qr || qr.trim()===""){ showNotif("⚠️ QR kosong, silahkan scan ulang"); return;}
        const parts = qr.split('|');
        if(parts.length<3 || !parts[0].trim() || !parts[1].trim() || !parts[2].trim()){
            showNotif("⚠️ QR tidak valid, silahkan scan ulang");
            return;
        }
        sudahAbsen=true;
        qrReader.stop();
        showSuccessWA();
        kunciForm();
        if(document.getElementById("scanStatus")) document.getElementById("scanStatus").innerText="QR Terdeteksi ✅";
        kirimWAmanual(parts[1],parts[2],parts[0],"HADIR","-",new Date().toLocaleDateString());
    });
});

/* Manual Form WA */
const tombolManual = document.getElementById("kirimManual");
if(tombolManual){
    tombolManual.addEventListener("click", function(e){
        e.preventDefault();
        if(sudahAbsen) return;
        const nis = document.getElementById("manualId").value.trim();
        const nama = document.getElementById("manualNama").value.trim();
        const no_absen = document.getElementById("manualKelas").value.trim();
        const status = document.getElementById("manualStatus").value;
        const ket = document.getElementById("manualKet").value.trim();
        const tanggal = new Date().toLocaleDateString();
        if(!nis || !nama || !no_absen){
            showNotif("⚠️ Silahkan mengisi semua form terlebih dahulu");
            return;
        }
        sudahAbsen=true;
        showSuccessWA();
        kunciForm();
        kirimWAmanual(nama,no_absen,nis,status,ket,tanggal);
    });
}

/* Tombol back reload */
document.getElementById("backBtn")?.addEventListener("click",()=>location.reload());
</script>

</body>
</html>
